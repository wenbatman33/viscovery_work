(function(){"use strict";function e(e,t){t=void 0===t||t,t?(e.parentNode.addEventListener("mouseover",function(){this.parentElement.querySelector(".pin-button").style.opacity=.9}),e.parentNode.addEventListener("mouseleave",function(){this.parentElement.querySelector(".pin-button").style.opacity=0})):(e.parentNode.addEventListener("mouseover",function(){this.querySelector(".pin-button").style.opacity=.9}),e.parentNode.addEventListener("mouseleave",function(){this.querySelector(".pin-button").style.opacity=0}))}function t(t){if(!t)throw"iframeElement undefined";this.type="",this.vid="",this.url="",this.regexList=[],this.iframeSrc=decodeURIComponent(t.src);var i={facebook:"facebook",youtube:"youtu",dailymotion:"dailymotion",vimeo:"vimeo"},r=/(http|https):\/\/(player|www).(facebook|youtu|dailymotion|vimeo)/i,n=r.exec(this.iframeSrc);switch(n&&n.length>3&&(this.type=n[3].toLowerCase()),this.type){case i.facebook:var a=/^(https|http):\/\/www.facebook.com\/plugins\/video.php\?href=/i,s=/(https|http):\/\/www.facebook.com\/+.*\/video(s\/(vb\..*\/(\d+)|(\d+))|\.php\?v=(\d+))/i;this.regexList.push(a),this.regexList.push(s);break;case i.youtube:var c=/(http|https):\/\/www.youtube.com\/((v|embed)\/)([\w-]+)/i;this.regexList.push(c);break;case i.dailymotion:var u=/(http|https):\/\/www.dailymotion.com\/embed\/video\/([A-Za-z0-9]+)/i;this.regexList.push(u);break;case i.vimeo:var h=/(http|https):\/\/player.vimeo.com\/video\/([A-Za-z0-9]+)/i;this.regexList.push(h)}if(this.regexList.forEach(function(e,t){var o=e.exec(this.iframeSrc);switch(this.type){case i.facebook:var r=this.regexList[0].test(this.iframeSrc);if(1==t&&r&&o&&o.length>6){var n=o[2];n.indexOf(".php")!=-1?this.vid=o[6]:n.indexOf("vb.")!=-1?this.vid=o[4]:n.indexOf("s/")!=-1&&(this.vid=o[3]),this.url=o[0]}break;case i.youtube:o&&o.length>4&&(this.vid=o[4],this.url=pinstream.GetYoutuBeUrlById(this.vid));break;case i.dailymotion:o&&o.length>2&&(this.vid=o[2],this.url=pinstream.GetDailyMotionUrlById(this.vid));break;case i.vimeo:o&&o.length>2&&(this.vid=o[2],this.url=pinstream.GetVimeoUrlById(this.vid))}},this),this.vid&&this.url){var d=document.createElement("div");d.appendChild(o(this.url,this.vid)),t.parentNode.insertBefore(d,t),d.appendChild(t),e(t)}}function i(){var e=[".yt-lockup-thumbnail",".thumb-wrapper",".ux-thumb-wrap"];e.forEach(function(e,t){var i=document.querySelectorAll(e);i&&i.length&&i.forEach(function(e,t){if(!e.querySelector(".pin-button")){var i=e.querySelector("a");if(i){var r=i.href,n=a.exec(r);if(a.test(r)&&n[6].toLowerCase().indexOf("channel")==-1){var s=o(r),c=e.firstChild;e.insertBefore(s,c)}}}})})}function o(e,t){var i=document.createElement("button");return i.className="pin-button",i.dataset.url=e,i.dataset.vid=t,i.addEventListener("click",function(e){e.preventDefault();var t=this.dataset.url,i=this.dataset.vid;r(t,i)}),i}function r(e,t){var i=a.exec(e);if(i&&i.length>2){var o=i[3];if(o.indexOf("youtu")>-1)return void pinstream.OnSaveYoutubeInfo(e)}var r=/(http|https):\/\/www.dailymotion.com\/embed\/video\/([A-Za-z0-9]+)/i;return r.test(e)?void pinstream.OnSaveDailyMotionInfo(e,t):void pinstream.OnSaveFbInfo(e,t)}chrome.runtime.onMessage.addListener(function(i,r,n){switch(i){case"Loading":console.info("Loading");var a={uid:localStorage.getItem("uid"),token:localStorage.getItem("token"),refresh_token:localStorage.getItem("refresh_token"),expires_in:localStorage.getItem("expires_in")};chrome.runtime.sendMessage({action:0,info:a},function(){console.info("sendMessage")});break;case"VideoPage":var s=document.querySelectorAll("iframe");s.forEach(function(e){new t(e)},this);break;case"postevent":var c=document.querySelectorAll("._10.uiLayer");return void(c&&c.forEach(function(t,i){var r=t.querySelectorAll("a[data-channel-id]");r&&r.length&&r.forEach(function(t,i){if(!t.parentElement.querySelector(".pin-button")){var r=t.href,n=t.dataset.videoId,a=o(r,n);t.parentNode.insertBefore(a,t),e(t)}})}))}});var n=document.querySelectorAll("iframe");n.forEach(function(e){new t(e)},this);var a=new RegExp(/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(embed\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/),s=a.exec(location.href);if(s&&s[3].indexOf("youtu")>-1){var c=document.querySelector("#page");if(c){var u={childList:!0,subtree:!0},h=new MutationObserver(function(e){if(e&&e.length){var t=e[0].target.className.toLowerCase();if("ytp-time-current"==t||"ytp-tooltip-text"==t)return;h.disconnect(),i(),h.observe(c,u)}});h.observe(c,u)}var d=document.querySelector("#player #player-mole-container");if(d){var l=a.exec(location.href);if(l.length>6&&l[3].indexOf("youtu")!=-1){var v=location.href,f=l[6],p=o(v,f);d.children&&d.children.length&&(d.insertBefore(p,d.children[0]),e(d))}}}})();