var PinstreamWeb={info:{isExtension:!1,clientIdName:"source_id"},init:function(e){PinstreamWeb.info.isExtension=e,PinstreamUtilitiesWeb.uid()&&PinstreamWeb.RedirectToMamagement("True"==PinstreamWeb.info.isExtension),window.fbAsyncInit=function(){FB.init({appId:"1128854430548522",xfbml:!0,version:"v2.9"}),FB.AppEvents.logPageView()},function(e,n,t){var i,a=e.getElementsByTagName(n)[0];e.getElementById(t)||(i=e.createElement(n),i.id=t,i.src="//connect.facebook.net/en_US/sdk.js",a.parentNode.insertBefore(i,a))}(document,"script","facebook-jssdk")},login:function(){var e=document.getElementById("form-login");if(e&&e.length){var n=document.getElementById("error-area");n.className="displaynone";for(var t=new FormData(e),i=0;i<e.length;i++){var a=e[i];t.append(a.id,a.value)}t.append(PinstreamWeb.info.clientIdName,PinstreamUtilitiesWeb.clientId);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&200==o.status&&!PinstreamWeb.OnRedirectToMamagement(o.responseText)){var e=document.getElementById("error-area");e.className="displayblock"}},o.open("POST","/api/v1/login/email"),o.send(t)}},RedirectToMamagement:function(e){e?window.location.href="/u/success":window.location.href="/u/mamagement"},CheckLogin:function(){FB.getLoginStatus(function(e){"connected"===e.status&&(console.log("Logged in."),PinstreamWeb.GetFbInfo())})},GetFbInfo:function(){FB.api("/me","GET",{fields:"id,name,email,birthday"},function(e){if(e.id&&e.email,e.birthday){var n="id="+e.id+"&email="+e.email+"&birthday="+e.birthday+"&"+PinstreamWeb.info.clientIdName+"="+PinstreamUtilitiesWeb.clientId;PinstreamWeb.Enroll(n)}})},Enroll:function(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&PinstreamWeb.OnRedirectToMamagement(n.responseText),console.info("Server error")},n.open("POST","/api/v1/enroll",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("cache-control","no-cache"),n.send(e)},OnRedirectToMamagement:function(e){if(e){var n=JSON.parse(e);if(n&&n.isSuccess)return PinstreamUtilitiesWeb.setTokenInfoTolocalStorage(n),PinstreamWeb.RedirectToMamagement("True"==PinstreamWeb.info.isExtension),!0}return!1}};